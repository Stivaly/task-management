<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet">
    <title>Document</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app"></div>

    <script>
        const { ref, computed, onMounted } = Vue;

        let lastId = 0;

        const app = Vue.createApp({
            setup() {
                const mostrarFormulario = ref(false);
                const ocultarFormulario = mostrarFormulario.value = false
                const lnombre = ref('');
                const lpaginas = ref('');
                const leditorial = ref('');
                const lautor = ref('');
                const lfecha = ref('');
                const lidioma = ref('');
                const lresumen = ref('');
                const libros = ref([]);
                const librosPorPagina = 2;
                const paginaActual = ref(1);
                const mostrarResumen = ref(true);


                const librosPaginados = computed(() => {
                    const inicio = (paginaActual.value - 1) * librosPorPagina;
                    const fin = paginaActual.value * librosPorPagina;
                    return libros.value.slice(inicio, fin);
                });

                const truncate = (text, length) => {
                    if (text) {
                        return text.length > length ? text.substring(0, length) + '...' : text;
                    } else {
                        return '';
                    }
                };

                const totalPaginas = computed(() => Math.ceil(libros.value.length / librosPorPagina));

                const handleSubmit = () => {
                    if (!lnombre.value || !leditorial.value || !lautor.value || !lresumen.value) {
                        alert('Ingrese todos los campos')
                        return
                    }

                    const nuevoLibro = {
                        id: lastId++,
                        nombre: lnombre.value,
                        editorial: leditorial.value,
                        autor: lautor.value,
                        resumen: lresumen.value
                    }

                    libros.value.push(nuevoLibro)

                    mostrarFormulario.value = false

                    lnombre.value = ''
                    leditorial.value = ''
                    lautor.value = ''
                    lresumen.value = ''
                    
                    // Ajustar la página actual para mostrar el nuevo libro si está en una nueva página
                    if (libros.value.length > paginaActual.value * librosPorPagina) {
                        paginaActual.value = totalPaginas.value
                    }
                };

                const toggleColumnas = () => {
                    mostrarResumen.value = !mostrarResumen.value;
                };

                const eliminarProducto =  (id) => {
                    const index = libros.value.findIndex(libro => libro.id === id);
                    if (index !== -1) {
                        libros.value.splice(index, 1);
                    }
                    alert('Producto eliminado exitosamente');
                };

                const cambiarPagina = (pagina) => {
                    if (pagina >= 1 && pagina <= totalPaginas.value) {
                        paginaActual.value = pagina;
                    }
                };

                const activeButton = ref('almacen');
                const setActive = (button) => {
                    activeButton.value = button;
                    mostrarFormulario.value = button === 'agregar';
                };

                const toggleReadMore = (libro) => {
                    libro.readMore = !libro.readMore;
                };

                return {
                    mostrarFormulario,
                    lnombre,
                    lpaginas,
                    leditorial,
                    lautor,
                    lfecha,
                    lidioma,
                    lresumen,
                    libros,
                    librosPorPagina,
                    paginaActual,
                    mostrarResumen,
                    librosPaginados,
                    truncate,
                    totalPaginas,
                    handleSubmit,
                    toggleColumnas,
                    eliminarProducto,
                    cambiarPagina,
                    activeButton,
                    setActive,
                    toggleReadMore
                };
            },
            template:`
            <nav class="navbar navbar-expand-lg bg-beige">
                <div class="container-fluid">
                        <a class="navbar-brand logo-nav" href="#">
                        <svg width="36" height="24" viewBox="0 0 36 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g id="Icon">
                            <path id="Vector" d="M19.6362 13.1341L14.2452 22.3669L8.85434 13.1341H19.6362ZM21.0804 12.3088H7.4043L14.2452 24L21.0804 12.3088Z" fill="#263238"/>
                            <path id="Vector_2" d="M29.0089 1.65038L34.3998 10.8833H23.618L29.0089 1.65038ZM29.0089 0L22.168 11.6912H35.8499L29.0089 0Z" fill="#263238"/>
                            <path id="Vector_3" d="M0.849854 0L6.58576 10.3409L12.8537 0.259661L0.849854 0Z" fill="#2194F3"/>
                            <path id="Vector_4" d="M14.2454 0.905762L20.262 11.1889H8.21716L14.2454 0.905762Z" fill="#FBC02D"/>
                            <path id="Vector_5" d="M21.8113 13.4341L27.8337 24H15.5024L21.6242 13.4341H21.8113Z" fill="#FBC02D"/>
                            <path id="Vector_6" d="M23.1152 12.7935L29.0089 23.1978L34.9845 12.7935H23.1152Z" fill="#2194F3"/>
                            </g>
                        </svg>
                        <div class="text-logo mt-2"> MTASK </div>
                        </a>
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse justify-content-center" id="navbarNav" style="width: 1100px !important;">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                            <a class="nav-link a-text" aria-current="page" href="index.html">Home</a>
                            </li>
                            <li class="nav-item">
                            <a class="nav-link a-text active" href="profile.html">Profile</a>
                            </li>
                            <li class="nav-item">
                            <a class="nav-link a-text" href="manager.html">Manager</a>
                            </li>
                            
                            <li class="nav-item">
                            <a class="nav-link a-text" href="contact.html">Contact</a>
                            </li>
                        </ul>
                        </div>
                        <nav class="navbar bg-body-tertiary navbar-collapse collapse" id="navbarNav" style="width: 220px !important;">
                        <form class="justify-content-end">
                            <button class="btn btn-sm btn-outline-success text-btn me-2" type="button">Sign up</button>
                            <button class="btn btn-sm btn-outline-secondary text-btn" type="button">Login</button>
                        </form>
                        </nav>
                    </div>

            </nav>
            <div class="container-fluid text-center full-height ingreso">
                <div class="row g-0">
                <div class="col">
                    <div class="row">
                    <div class="col">
                        <div class="logoUsuario">
                        <img src="../img/usuario.png" class="imgUsuario mt-5" alt="..." />
                        <div class="card-body">
                            <h5 class="card-title">Juan Perez</h5>
                            <p class="card-text">Jefe de Bodega</p>
                        </div>
                        </div>
                    </div>
                    </div>

                    <div class="row g-0">
                    <div class="col">
                        <div class="menuVertical">
                        <div class="list-group mx-4">
                            <button @click="mostrarFormulario = false; mostrarResumen = true; setActive('almacen')" 
                                    :aria-current="activeButton === 'almacen' ? 'true' : 'false'" 
                                    type="button" 
                                    class="list-group-item list-group-item-action" 
                                    :class="{ active: activeButton === 'almacen' }">
                            Almacén
                            </button>
                            <button @click="mostrarFormulario = true; mostrarResumen = true; setActive('agregar')" 
                                    :aria-current="activeButton === 'agregar' ? 'true' : 'false'" 
                                    type="button" 
                                    class="list-group-item list-group-item-action"
                                    :class="{ active: activeButton === 'agregar' }">
                            Agregar Producto
                            </button>
                            <button @click="mostrarFormulario = false; toggleColumnas(); setActive('eliminar'); "
                                    :aria-current="activeButton === 'eliminar' ? 'true' : 'false'" 
                                    type="button" 
                                    class="list-group-item list-group-item-action"
                                    :class="{ active: activeButton === 'eliminar'}">
                            Eliminar Producto
                            </button>
                            <button @click="mostrarFormulario = false; mostrarResumen = true; setActive('informe')"
                                    :aria-current="activeButton === 'informe' ? 'true' : 'false'"  
                                    type="button" 
                                    class="list-group-item list-group-item-action"
                                    :class="{ active: activeButton === 'informe' }">
                            Generar Informe de Movimientos
                            </button>
                        </div>
                        </div>
                    </div>
                    </div>
                </div>
                <div class="col-10 encabezado">
                    <div v-if="mostrarFormulario && !ocultarFormulario" class="con-derecho">
                    <div class="contenido">
                        <h3>Ingreso de Libros</h3>
                        <div class="d-flex justify-content-start">
                        Campos obligatorios: <span class="text-danger">* </span> 
                        </div>
                        <br>
                        <form class="formulario-productos" @submit.prevent="handleSubmit">
                        <div class="form-group text-start">
                            <label for="lnombre" class="text-dark"><span class="text-danger">* </span> Ingrese nombre del libro: </label>
                            <input v-model="lnombre" class="form-control" type="text" id="lnombre" placeholder="Nombre Libro"
                            /><br />
                            <label for="leditorial" class="text-dark"><span class="text-danger">* </span>Ingrese nombre de la editorial:</label>
                            <input v-model="leditorial" class="form-control" type="text" id="leditorial" placeholder="Nombre Editorial"  /><br />
                            <label for="lautor" class="text-dark"><span class="text-danger">* </span>Ingrese nombre del autor: </label>
                            <input v-model="lautor" class="form-control" type="text" id="lautor" placeholder="Nombre Autor"
                            /><br />
                            <label for="lresumen" class="text-dark"><span class="text-danger">* </span>Ingrese resumen del libro: </label>
                            <textarea v-model="lresumen" class="form-control" id="lresumen" placeholder="Resumen" rows="3"
                            ></textarea><br>
                            <button type="submit" class="btn btn-primary me-3" value="Enviar">Agregar</button>
                            <button @click="mostrarFormulario = false" type="button" class="btn btn-primary"
                            value="Cancelar">Cancelar</button>
                        </div>
                        </form>
                    </div>
                    </div>

                    <div class="mt-4">
                    <div class="mx-3">

                        <h3>Lista de Libros</h3>
                        <table class="table">
                        <thead>
                            <tr>
                            <th>Id</th>
                            <th>Nombre</th>
                            <th>Editorial</th>
                            <th>Autor</th>
                            <th v-if="mostrarResumen">Resumen</th>
                            <th v-if="!mostrarResumen">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-if="librosPaginados.length === 0">
                            <td colspan="8" class="text-center">No hay libros ingresados</td>
                            </tr>
                            <tr v-for="libro in librosPaginados" :key="libro.id_libro">
                                <td>{{ libro.id }}</td>
                                <td>{{ libro.nombre }}</td>
                                <td>{{ libro.editorial }}</td>
                                <td>{{ libro.autor }}</td>
                                <td v-if="mostrarResumen">
                                    <div class="resumen-container">
                                        <p>{{ libro.readMore ? libro.resumen : truncate(libro.resumen, 30) }}</p>
                                        <button class="btn btn-success btn-sm" @click="toggleReadMore(libro)">
                                            {{ libro.readMore ? '-' : '+' }}
                                        </button>
                                    </div>
                                </td>
                            <td v-if="!mostrarResumen">
                                <button @click="eliminarProducto(libro.id)" type="button" class="btn btn-danger">Eliminar</button>
                            </td>
                            </tr>
                        </tbody>
                        </table>
                    </div>
                    </div>

                    <!-- Controles de paginación -->
                    <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" :class="{ 'disabled': paginaActual === 1 }">
                        <a class="page-link" href="#" @click.prevent="cambiarPagina(paginaActual - 1)">Anterior</a>
                        </li>
                        <li class="page-item" v-for="pagina in totalPaginas" :key="pagina"
                        :class="{ 'active': pagina === paginaActual }">
                        <a class="page-link" href="#" @click.prevent="cambiarPagina(pagina)">{{ pagina }}</a>
                        </li>
                        <li class="page-item" :class="{ 'disabled': paginaActual === totalPaginas }">
                        <a class="page-link" href="#" @click.prevent="cambiarPagina(paginaActual + 1)">Siguiente</a>
                        </li>
                    </ul>
                    </nav>
                </div>
                </div>
            </div>
            `

        });

        app.mount('#app');
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>
</html>